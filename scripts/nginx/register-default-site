#! /bin/bash

# 1. VARIABLES +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

TASK_TYPE="NGINX CONFIG";
TASK_NAME=$DOMAIN;

# 1. END +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

# 2. SCRIPT ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

echo ""
echo "+"
echo "+ $TASK_TYPE: $TASK_NAME"
echo "+"
echo ""

# CREATE STRUCTURE IF NEEDED

echo "- Check NGINX conf file:";
echo "-";
if [ -d $HABITAT_PATH/nginx/sites/$DOMAIN.conf ]
then
  rm -rf $HABITAT_PATH/nginx/sites/$DOMAIN.conf && echo "- ✅ Removed existing conf file";
fi

echo "- Create $DOMAIN conf file:";
echo "-";

echo "server {
  listen 80;
  listen [::]:80;

  root /var/www/$DOMAIN/www;
  index index.html;

  server_name $DOMAIN;

  location / {
    try_files \$uri \$uri/ =404;
  }
}" > $HABITAT_PATH/nginx/sites/$DOMAIN.conf && echo "- ✅ Created conf file";

echo ""
echo "= $TASK_TYPE COMPLETE"

# 2. END +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++